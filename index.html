<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#9333ea">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="El Impostor">
  <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogIkVsIEltcG9zdG9yIiwKICAic2hvcnRfbmFtZSI6ICJJbXBvc3RvciIsCiAgInN0YXJ0X3VybCI6ICIuIiwKICAiZGlzcGxheSI6ICJzdGFuZGFsb25lIiwKICAiYmFja2dyb3VuZF9jb2xvciI6ICIjOTMzM2VhIiwKICAidGhlbWVfY29sb3IiOiAiIzkzMzNlYSIsCiAgImljb25zIjogW10KfQ==">
  <title>El Impostor</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body>
  <div id="root"></div>
  
  <script type="text/babel">
    const { useState, useEffect } = React;

    // Iconos SVG simplificados
    const Users = () => (
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
        <circle cx="9" cy="7" r="4"></circle>
        <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
        <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
      </svg>
    );

    const Eye = () => (
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
        <circle cx="12" cy="12" r="3"></circle>
      </svg>
    );

    const EyeOff = () => (
      <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path>
        <line x1="1" y1="1" x2="23" y2="23"></line>
      </svg>
    );

    const Settings = () => (
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <circle cx="12" cy="12" r="3"></circle>
        <path d="M12 1v6m0 6v6m6-12.9l-4.5 2.6m-3 5.2L6 18.9m12.9-6l-2.6 4.5m-5.2 3L6.9 12m12.9-6L15 10.5m-6 3L3 15.1"></path>
      </svg>
    );

    const Play = () => (
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <polygon points="5 3 19 12 5 21 5 3"></polygon>
      </svg>
    );

    const RotateCcw = () => (
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <polyline points="1 4 1 10 7 10"></polyline>
        <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"></path>
      </svg>
    );

    function ImpostorGame() {
      const [screen, setScreen] = useState('menu');
      const [numPlayers, setNumPlayers] = useState(4);
      const [numImpostors, setNumImpostors] = useState(1);
      const [showHint, setShowHint] = useState(true);
      const [blacklist, setBlacklist] = useState('');
      const [currentPlayer, setCurrentPlayer] = useState(0);
      const [revealed, setRevealed] = useState(false);
      const [gameData, setGameData] = useState(null);
      const [loading, setLoading] = useState(false);
      const [startingPlayer, setStartingPlayer] = useState(null);
      const [usedWords, setUsedWords] = useState([]);

      // Sistema de almacenamiento local
      useEffect(() => {
        loadUsedWords();
      }, []);

      const loadUsedWords = () => {
        try {
          const stored = localStorage.getItem('used-words');
          if (stored) {
            setUsedWords(JSON.parse(stored));
          }
        } catch (error) {
          console.log('No hay palabras guardadas aÃºn');
        }
      };

      const saveUsedWord = (word) => {
        try {
          const newWords = [...usedWords, word].slice(-200);
          setUsedWords(newWords);
          localStorage.setItem('used-words', JSON.stringify(newWords));
        } catch (error) {
          console.error('Error guardando palabra:', error);
        }
      };

      const generateGame = async () => {
        setLoading(true);
        try {
          const blacklistText = blacklist.trim() 
            ? `NO uses palabras relacionadas con: ${blacklist}` 
            : '';
          
          const usedWordsText = usedWords.length > 0
            ? `IMPORTANTE: NO repitas ninguna de estas palabras ya usadas: ${usedWords.join(', ')}.`
            : '';
          
          const prompt = `Genera UNA palabra en espaÃ±ol para un juego del impostor. ${blacklistText} ${usedWordsText}

Requisitos:
- La palabra puede ser de CUALQUIER categorÃ­a: objetos, lugares, profesiones, animales, conceptos abstractos, actividades, Ã©pocas histÃ³ricas, fenÃ³menos naturales, deportes, alimentos, partes del cuerpo, emociones, edificios, vehÃ­culos, instrumentos, etc.
- VARÃA la categorÃ­a - no uses siempre la misma temÃ¡tica
- Debe ser algo concreto que se pueda describir sin ser demasiado obvio
- Apropiada para todas las edades
- ${showHint ? 'Incluye una pista de SOLO UNA PALABRA extremadamente vaga y ambigua. La pista debe ser tan indirecta que podrÃ­a aplicarse a docenas de cosas diferentes. Usa asociaciones MUY lejanas, contextos amplÃ­simos, o caracterÃ­sticas ultra genÃ©ricas. El impostor debe tener que adivinar casi completamente. Ejemplos de buenas pistas: "exteriores", "movimiento", "antiguo", "social", "sensorial".' : 'NO incluyas pista'}

Responde SOLO con este formato JSON:
{
  "palabra": "la palabra elegida",
  ${showHint ? '"pista": "una palabra extremadamente vaga"' : '"pista": null'}
}`;

          const response = await fetch('https://api.anthropic.com/v1/messages', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              model: 'claude-sonnet-4-20250514',
              max_tokens: 1000,
              messages: [
                { role: 'user', content: prompt }
              ],
            })
          });

          const data = await response.json();
          const content = data.content[0].text;
          const cleanJson = content.replace(/```json|```/g, '').trim();
          const result = JSON.parse(cleanJson);

          saveUsedWord(result.palabra);

          const players = Array.from({ length: numPlayers }, (_, i) => i);
          const shuffled = players.sort(() => Math.random() - 0.5);
          const impostorIndices = shuffled.slice(0, numImpostors);

          setGameData({
            palabra: result.palabra,
            pista: result.pista,
            impostores: impostorIndices
          });

          setCurrentPlayer(0);
          setRevealed(false);
          setStartingPlayer(Math.floor(Math.random() * numPlayers) + 1);
          setScreen('game');
        } catch (error) {
          console.error('Error:', error);
          alert('Error al generar la palabra. Intenta de nuevo.');
        }
        setLoading(false);
      };

      const nextPlayer = () => {
        setRevealed(false);
        if (currentPlayer < numPlayers - 1) {
          setCurrentPlayer(currentPlayer + 1);
        } else {
          setScreen('end');
        }
      };

      const isImpostor = gameData?.impostores.includes(currentPlayer);

      if (screen === 'menu') {
        return (
          <div className="min-h-screen bg-gradient-to-br from-purple-600 via-pink-600 to-red-600 p-4 flex items-center justify-center">
            <div className="bg-white rounded-3xl shadow-2xl p-8 max-w-md w-full">
              <div className="text-center mb-8">
                <div className="text-7xl mb-4">ðŸŽ­</div>
                <h1 className="text-4xl font-bold text-gray-800">El Impostor</h1>
              </div>

              <div className="space-y-6">
                <div>
                  <label className="flex items-center text-gray-700 font-semibold mb-2">
                    <Users />
                    <span className="ml-2">NÃºmero de jugadores</span>
                  </label>
                  <input
                    type="number"
                    min="3"
                    max="12"
                    value={numPlayers}
                    onChange={(e) => setNumPlayers(parseInt(e.target.value))}
                    className="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:border-purple-500 focus:outline-none text-lg"
                  />
                </div>

                <div>
                  <label className="flex items-center text-gray-700 font-semibold mb-2">
                    <Eye />
                    <span className="ml-2">NÃºmero de impostores</span>
                  </label>
                  <input
                    type="number"
                    min="1"
                    max={Math.floor(numPlayers / 2)}
                    value={numImpostors}
                    onChange={(e) => setNumImpostors(parseInt(e.target.value))}
                    className="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:border-purple-500 focus:outline-none text-lg"
                  />
                </div>

                <div className="flex items-center justify-between bg-gray-100 rounded-xl p-4">
                  <span className="text-gray-700 font-semibold">Dar pista al impostor</span>
                  <button
                    onClick={() => setShowHint(!showHint)}
                    className={`w-14 h-8 rounded-full transition-colors ${
                      showHint ? 'bg-purple-600' : 'bg-gray-300'
                    }`}
                  >
                    <div
                      className={`w-6 h-6 bg-white rounded-full shadow-md transform transition-transform ${
                        showHint ? 'translate-x-7' : 'translate-x-1'
                      }`}
                    />
                  </button>
                </div>

                <div>
                  <label className="flex items-center text-gray-700 font-semibold mb-2">
                    <Settings />
                    <span className="ml-2">CategorÃ­as excluidas (opcional)</span>
                  </label>
                  <textarea
                    value={blacklist}
                    onChange={(e) => setBlacklist(e.target.value)}
                    placeholder="Ej: objetos de casa, animales, comida..."
                    className="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:border-purple-500 focus:outline-none resize-none"
                    rows="3"
                  />
                </div>

                <button
                  onClick={generateGame}
                  disabled={loading}
                  className="w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white font-bold py-4 rounded-xl hover:shadow-lg transform hover:scale-105 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center"
                >
                  {loading ? (
                    <>
                      <div className="animate-spin rounded-full h-6 w-6 border-b-2 border-white mr-3" />
                      Generando...
                    </>
                  ) : (
                    <>
                      <Play />
                      <span className="ml-2">Iniciar Juego</span>
                    </>
                  )}
                </button>

                {usedWords.length > 0 && (
                  <div className="text-center text-sm text-gray-500 mt-3">
                    ðŸŽ¯ {usedWords.length} palabras en memoria
                  </div>
                )}
              </div>
            </div>
          </div>
        );
      }

      if (screen === 'game') {
        return (
          <div className="min-h-screen bg-gradient-to-br from-blue-500 via-purple-500 to-pink-500 p-4 flex items-center justify-center">
            <div className="bg-white rounded-3xl shadow-2xl p-8 max-w-md w-full">
              <div className="text-center mb-6">
                <div className="text-gray-600 font-semibold mb-2">
                  Jugador {currentPlayer + 1} de {numPlayers}
                </div>
                <div className="w-full bg-gray-200 rounded-full h-3 mb-6">
                  <div
                    className="bg-gradient-to-r from-purple-600 to-pink-600 h-3 rounded-full transition-all"
                    style={{ width: `${((currentPlayer + 1) / numPlayers) * 100}%` }}
                  />
                </div>
              </div>

              {!revealed ? (
                <div className="text-center py-12">
                  <div className="bg-gradient-to-r from-purple-600 to-pink-600 w-24 h-24 rounded-full flex items-center justify-center mx-auto mb-6">
                    <EyeOff />
                  </div>
                  <h2 className="text-2xl font-bold text-gray-800 mb-4">
                    Jugador {currentPlayer + 1}
                  </h2>
                  <p className="text-gray-600 mb-8">
                    Toca el botÃ³n cuando estÃ©s listo para ver tu rol
                  </p>
                  <button
                    onClick={() => setRevealed(true)}
                    className="bg-gradient-to-r from-purple-600 to-pink-600 text-white font-bold py-4 px-8 rounded-xl hover:shadow-lg transform hover:scale-105 transition-all"
                  >
                    Ver mi rol
                  </button>
                </div>
              ) : (
                <div className="text-center py-8">
                  {isImpostor ? (
                    <div className="bg-red-50 border-4 border-red-500 rounded-2xl p-6 mb-6">
                      <div className="text-6xl mb-4">ðŸŽ­</div>
                      <h2 className="text-3xl font-bold text-red-600 mb-4">
                        Â¡Eres el IMPOSTOR!
                      </h2>
                      {gameData.pista ? (
                        <div className="bg-white rounded-xl p-4 border-2 border-red-300">
                          <p className="text-gray-600 text-sm mb-2">Tu pista:</p>
                          <p className="text-red-600 font-bold text-xl">
                            {gameData.pista}
                          </p>
                        </div>
                      ) : (
                        <p className="text-red-600">No tienes ninguna pista</p>
                      )}
                    </div>
                  ) : (
                    <div className="bg-green-50 border-4 border-green-500 rounded-2xl p-6 mb-6">
                      <div className="text-6xl mb-4">âœ…</div>
                      <h2 className="text-3xl font-bold text-green-600 mb-4">
                        Eres CIVIL
                      </h2>
                      <div className="bg-white rounded-xl p-6 border-2 border-green-300">
                        <p className="text-gray-600 text-sm mb-2">Tu palabra es:</p>
                        <p className="text-green-600 font-bold text-3xl">
                          {gameData.palabra}
                        </p>
                      </div>
                    </div>
                  )}

                  <p className="text-gray-600 mb-6">
                    Memoriza tu informaciÃ³n y pasa el telÃ©fono al siguiente jugador
                  </p>

                  <button
                    onClick={nextPlayer}
                    className="bg-gradient-to-r from-purple-600 to-pink-600 text-white font-bold py-4 px-8 rounded-xl hover:shadow-lg transform hover:scale-105 transition-all w-full"
                  >
                    {currentPlayer < numPlayers - 1 ? 'Siguiente jugador' : 'Finalizar'}
                  </button>
                </div>
              )}
            </div>
          </div>
        );
      }

      return (
        <div className="min-h-screen bg-gradient-to-br from-green-500 via-teal-500 to-blue-500 p-4 flex items-center justify-center">
          <div className="bg-white rounded-3xl shadow-2xl p-8 max-w-md w-full text-center">
            <div className="text-6xl mb-6">ðŸŽ‰</div>
            <h2 className="text-3xl font-bold text-gray-800 mb-4">
              Â¡Que comience el juego!
            </h2>
            <p className="text-gray-600 mb-8">
              Todos los jugadores han visto sus roles. Ahora deben discutir y descubrir quiÃ©n es el impostor.
            </p>

            <div className="bg-gradient-to-r from-yellow-100 to-orange-100 border-2 border-yellow-400 rounded-xl p-6 mb-8">
              <div className="text-4xl mb-3">ðŸŽ¯</div>
              <h3 className="font-bold text-gray-800 text-xl mb-2">Â¡Empieza el Jugador {startingPlayer}!</h3>
              <p className="text-gray-600 text-sm">
                Elegido al azar para comenzar la ronda de descripciones
              </p>
            </div>

            <button
              onClick={() => setScreen('menu')}
              className="bg-gradient-to-r from-purple-600 to-pink-600 text-white font-bold py-4 px-8 rounded-xl hover:shadow-lg transform hover:scale-105 transition-all w-full flex items-center justify-center"
            >
              <RotateCcw />
              <span className="ml-2">Nueva partida</span>
            </button>
          </div>
        </div>
      );
    }

    ReactDOM.render(<ImpostorGame />, document.getElementById('root'));
  </script>
</body>
</html>